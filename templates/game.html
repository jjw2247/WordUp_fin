<!-- ìœ„ ì½”ë“œëŠ” ì˜¤ëŸ‰ì–´í•™ì‚¬ì „ì˜ ë‹¨ì–´ ê²Œì„ ë¶€ë¶„ì˜ HTML ì½”ë“œì…ë‹ˆë‹¤! -->
<!-- ì£¼ì„ ê´€ë ¨ ì˜¤ë¥˜ëŠ” ì œë³´í•´ì£¼ê¸¸ ë°”ëë‹ˆë‹¤! -->

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ§© ì˜¤ëŸ‰ í¬ë¡œìŠ¤ì›Œë“œ ê²Œì„</title>
  <style>

    /* ë‹¨ì–´ê²Œì„ ì˜¤ë²„ë ˆì´ */
    body {
      margin: 0;
      font-family: 'Pretendard', sans-serif;
      background: #f5f8f4;
    }

    /* í¬ë¡œìŠ¤ì›Œë“œ ì˜¤ë²„ë ˆì´ */
    .game-container {
      max-width: 900px;
      margin: 40px auto;
      padding: 30px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      position: relative;
    }

    h2 {
      color: #2E3A29;
      text-align: center;
    }
    /* ì ìˆ˜ & íƒ€ì´ë¨¸ ì˜¤ë²„ë ˆì´ */
    .score-timer {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      font-size: 20px;
      color: #4F774E;
      font-weight: bold;
    }
    /* í¬ë¡œìŠ¤ì›Œë“œ ê²½ê³„ ì˜¤ë²„ë ˆì´ */
    table.crossword {
      border-collapse: collapse;
      margin: 0 auto;
      user-select: none;
    }
    /* í¬ë¡œìŠ¤ì›Œë“œ ë°•ìŠ¤ ì˜¤ë²„ë ˆì´ */
    table.crossword td {
      width: 40px;
      height: 40px;
      text-align: center;
      vertical-align: middle;
      border: 1px solid #4F774E;
      background-color: #F0F5F0;
      border-radius: 12px;
      font-size: 20px;
      font-weight: bold;
      color: #2E3A29;
      cursor: pointer;
      transition: background 0.3s ease, color 0.3s ease;
      user-select: none;
      position: relative;
      overflow: hidden;
    }

    /* í¬ë¡œìŠ¤ì›Œë“œ ì •ë‹µ ì„ íƒ ì• ë‹ˆë©”ì´ì…˜ */
    table.crossword td.clicked {
      background-color: #b4e197 !important;
      color: #2e3a29;
      cursor: default;
      transition: background-color 0.4s ease;
      animation: cellClickAnim 0.3s ease;
    }

    /* í¬ë¡œìŠ¤ì›Œë“œ ì˜¤ë‹µ ì„ íƒ ì• ë‹ˆë©”ì´ì…˜ */
    table.crossword td.wrong {
      background-color: #f28b82 !important;
      color: white !important;
      cursor: default;
      animation: wrongClickAnim 0.5s ease forwards;
    }

    @keyframes cellClickAnim {
      0% { transform: scale(1); }
      50% { transform: scale(1.15); }
      100% { transform: scale(1); }
    }

    @keyframes wrongClickAnim {
      0% { transform: scale(1) rotate(0deg); }
      50% { transform: scale(1.2) rotate(-10deg); }
      100% { transform: scale(1) rotate(0deg); }
    }

    /* í¬ë¡œìŠ¤ì›Œë“œ íŒíŠ¸ ì˜¤ë²„ë ˆì´ */
    .hints {
      margin-top: 30px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      font-weight: bold;
      color: #4F774E;
      user-select: none;
    }

    /* í¬ë¡œìŠ¤ì›Œë“œ íŒíŠ¸ ë°°ê²½ ì˜¤ë²„ë ˆì´ */
    .hints p {
      background-color: #e0f0d9;
      padding: 8px 15px;
      border-radius: 10px;
      margin-bottom: 10px;
      cursor: pointer;
      transition: transform 0.3s ease, background-color 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    /* í¬ë¡œìŠ¤ì›Œë“œ íŒíŠ¸ í´ë¦­ ì• ë‹ˆë©”ì´ì…˜ */
    .hints p.clicked {
      animation: hintClickAnim 0.4s ease forwards;
    }

    @keyframes hintClickAnim {
      0% { transform: scale(1); background-color: #e0f0d9; }
      50% { transform: scale(1.1); background-color: #c6dfc7; }
      100% { transform: scale(1); background-color: #e0f0d9; }
    }

    /* í¬ë¡œìŠ¤ì›Œë“œ ì •ë‹µ ì²˜ë¦¬ & ì·¨ì†Œì„  */
    .hints p.completed {
      color: #999999;
      text-decoration: line-through;
      background-color: #f0f0f0 !important;
      cursor: default;
    }

    .confetti {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 0;
      pointer-events: none;
    }

    .confetti span {
      position: absolute;
      width: 8px;
      height: 8px;
      background-color: red;
      animation: fall 1s linear forwards;
    }

    @keyframes fall {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(500px) rotate(360deg); opacity: 0; }
    }
    /* ë‹¨ì–´ê²Œì„ ì „ì²´ ì˜¤ë²„ë ˆì´ */
    .overlay {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10;
    }
    /* í¬ë¡œìŠ¤ì›Œë“œ ì‹œì‘ íŒì—… ì˜¤ë²„ë ˆì´ */
    .popup {
      background: white;
      padding: 30px;
      border-radius: 16px;
      text-align: center;
      max-width: 400px;
      width: 90%;
    }
    /* í¬ë¡œìŠ¤ì›Œë“œ ì‹œì‘ íŒì—… ì œëª© ì˜¤ë²„ë ˆì´ */
    .popup h3 {
      margin-bottom: 20px;
      font-size: 22px;
      color: #333;
    }
    /* í¬ë¡œìŠ¤ì›Œë“œ ì‹œì‘ íŒì—… ë‚œì´ë„ ê°„ê²© */
    .popup .level {
      display: flex;
      justify-content: space-between;
      gap: 10px;
    }
    /* í¬ë¡œìŠ¤ì›Œë“œ ì‹œì‘ ë‚œì´ë„ ë°•ìŠ¤ ì˜¤ë²„ë ˆì´ */
    .popup .level div {
      flex: 1;
      padding: 20px 0;
      border-radius: 12px;
      background: #e0eede;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s ease, background 0.3s ease;
    }
    /* í¬ë¡œìŠ¤ì›Œë“œ ì‹œì‘ ì„ íƒ ì• ë‹ˆë©”ì´ì…˜ */
    .popup .level div:hover {
      background: #c6dfc7;
      transform: scale(1.05);
    }
    /* í¬ë¡œìŠ¤ì›Œë“œ ì¢…ë£Œ íŒì—… ì˜¤ë²„ë ˆì´ */
    .popup-end {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 20;
    }
    /* í¬ë¡œìŠ¤ì›Œë“œ ì¢…ë£Œ íŒì—… ë°•ìŠ¤ ì˜¤ë²„ë ˆì´ */
    .popup-end .box {
      background: white;
      padding: 30px;
      border-radius: 16px;
      text-align: center;
      max-width: 400px;
      width: 90%;
    }
    .popup-end h3 {
      margin-bottom: 15px;
    }

    .popup-end p {
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
    <!-- í¬ë¡œìŠ¤ì›Œë“œ ì‹œì‘ íŒì—… -->
  <div class="overlay" id="startOverlay">
    <div class="popup">
      <h3>ë‚œì´ë„ë¥¼ ê³¨ë¼ì£¼ì„¸ìš”</h3>
      <div class="level">
        <div onclick="startGame('easy')">ğŸŸ¢ Easy</div>
        <div onclick="startGame('medium')">ğŸŸ  Medium</div>
        <div onclick="startGame('hard')">ğŸ”´ Hard</div>
      </div>
    </div>
  </div>
    <!-- í¬ë¡œìŠ¤ì›Œë“œ ê²Œì„ ì˜¤ë²„ë ˆì´ -->
  <div class="game-container">
    <h2>ğŸ§© ì˜¤ëŸ‰ í¬ë¡œìŠ¤ì›Œë“œ ê²Œì„</h2>
    <div class="score-timer">
      <div>ì ìˆ˜ : <span id="score">0</span></div>
      <div>ì‹œê°„ : <span id="timer">05:00</span></div>
      <button onclick="location.reload()">ë‹¤ì‹œí•˜ê¸°</button>
    </div>
    <table class="crossword" id="crossword"></table>
    <div class="hints" id="hintList"></div>
    <div class="confetti" id="confetti"></div>
  </div>
    <!-- í¬ë¡œìŠ¤ì›Œë“œ ì¢…ë£Œ íŒì—… -->
  <div class="popup-end" id="endPopup">
    <div class="box">
      <h3>ğŸ‰ ê²Œì„ ì™„ë£Œ!</h3>
      <p id="finalTime"></p>
      <p id="finalScore"></p>
      <button onclick="location.reload()">ë‹¤ì‹œí•˜ê¸°</button>
    </div>
  </div>
    <!-- í¬ë¡œìŠ¤ì›Œë“œ ì¢…ë£ŒìŒ -->
  <audio id="applause" src="/static/sounds/applause.mp3"></audio>

    <!-- ë‹¨ì–´ ë°ì´í„° -->
  <script>
    const puzzles = {
      easy: {
        size: 3,
        words: [
          { word: 'ì—´ì •', meaning: 'ê°•í•œ ëª°ì… ê°ì •'},
          { word: 'í†µì°°', meaning: 'ë³¸ì§ˆì„ ê¿°ëš«ëŠ” ëŠ¥ë ¥'}
        ]
      },
      medium: {
        size: 5,
        words: [
          { word: 'ë…¼ë¦¬', meaning: 'ì²´ê³„ì ì¸ ì‚¬ê³  ë°©ì‹'},
          { word: 'í•´ì„', meaning: 'ëœ»ì„ ë°í˜'}
        ]
      },
      hard: {
        size: 8,
        words: [
          { word: 'ë¬¸ë§¥', meaning: 'ê¸€ì˜ íë¦„'},
          { word: 'ë¹„ìœ ', meaning: 'ì§ìœ /ì€ìœ  ê°™ì€ í‘œí˜„'},
          { word: 'ì˜ë¯¸', meaning: 'ë‹¨ì–´ë‚˜ ë¬¸ì¥ì˜ ëœ»'},
          { word: 'ë¯¸í•™', meaning: 'ì•„ë¦„ë‹¤ì›€ì— ëŒ€í•œ ì² í•™'}
        ]
      }
    };

    /* í¬ë¡œìŠ¤ì›Œë“œ ì‹œì‘ & ì´ˆê¸°í™” */
    let grid = [];
    let size = 0;
    let timer;
    let timeLeft = 60;
    let score = 0;
    let foundLettersCount = 0;


    /* í¬ë¡œìŠ¤ì›Œë“œ ì§„í–‰ ìƒí™© */
    let wordProgress = {};

    /* í¬ë¡œìŠ¤ì›Œë“œ ë‹¨ì–´ ì €ì¥ */
    let cellMap = [];

    let currentLevel = '';

    function createGrid(n) {
      size = n;
      grid = Array.from({ length: n }, () => Array(n).fill(null));
      cellMap = Array.from({ length: n }, () => Array(n).fill(null));
    }

    function fillWords(words) {
  words.forEach((wordObj, wordIndex) => {
    const word = wordObj.word;
    let placed = false;
    let attempts = 0;

    while (!placed && attempts < 100) {
      attempts++;

      const dir = Math.random() < 0.5 ? 'across' : 'down';
      const maxRow = dir === 'across' ? size : size - word.length;
      const maxCol = dir === 'across' ? size - word.length : size;

      const row = Math.floor(Math.random() * maxRow);
      const col = Math.floor(Math.random() * maxCol);

      /* í¬ë¡œìŠ¤ì›Œë“œ ë‹¨ì–´ ì¤‘ë³µ ì—¬ë¶€ í™•ì¸ */
      let canPlace = true;
      for (let i = 0; i < word.length; i++) {
        const r = dir === 'across' ? row : row + i;
        const c = dir === 'across' ? col + i : col;

        const cellChar = grid[r][c];
        if (cellChar !== null && cellChar !== word[i]) {
          canPlace = false;
          break;
        }
      }

      if (canPlace) {
        wordProgress[wordIndex] = 0;
        for (let i = 0; i < word.length; i++) {
          const r = dir === 'across' ? row : row + i;
          const c = dir === 'across' ? col + i : col;

          grid[r][c] = word[i];
          if (!cellMap[r][c]) cellMap[r][c] = [];
          cellMap[r][c].push({ wordIndex, charIndex: i });
        }

        /* í¬ë¡œìŠ¤ì›Œë“œ ë‹¨ì–´ ìœ„ì°¨ & ë°©í–¥ ì €ì¥ */
        wordObj.row = row;
        wordObj.col = col;
        wordObj.dir = dir;

        placed = true;
      }
    }

    if (!placed) {
      console.warn(`ë‹¨ì–´ë¥¼ ë°°ì¹˜í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤: ${word}`);
    }
  });
}

      /* í¬ë¡œìŠ¤ì›Œë“œ ì„ì‹œ ë‹¨ì–´ ì„¤ì • */
    function fillRandomLetters() {
      const chars = "ê°€ë‚˜ë‹¤ë¼ë§ˆë°”ì‚¬ì•„ìì°¨ì¹´íƒ€íŒŒí•˜";
      for (let r = 0; r < size; r++) {
        for (let c = 0; c < size; c++) {
          if (!grid[r][c]) {
            grid[r][c] = chars[Math.floor(Math.random() * chars.length)];
            cellMap[r][c] = null;
          }
        }
      }
    }

    function renderGrid() {
      const table = document.getElementById("crossword");
      table.innerHTML = "";
      for (let r = 0; r < size; r++) {
        const tr = document.createElement("tr");
        for (let c = 0; c < size; c++) {
          const td = document.createElement("td");
          td.textContent = grid[r][c];
          td.id = `cell-${r}-${c}`;
          td.classList.remove('clicked', 'wrong');
          td.dataset.checked = '';

          td.addEventListener('click', () => handleCellClick(r, c, td));
          tr.appendChild(td);
        }
        table.appendChild(tr);
      }
    }
    
    /* í¬ë¡œìŠ¤ì›Œë“œ íŒíŠ¸ */
    function renderHints(words) {
      const list = document.getElementById("hintList");
      list.innerHTML = "";
      words.forEach(({ meaning }, idx) => {
        const p = document.createElement("p");
        p.textContent = `ğŸ’¡ ${meaning}`;
        p.dataset.wordIndex = idx;

        /* í¬ë¡œìŠ¤ì›Œë“œ ë‹¨ì–´ í´ë¦­ ì• ë‹ˆë©”ì´ì…˜ */
        p.addEventListener('click', () => {
        
          p.classList.add('clicked');
          setTimeout(() => p.classList.remove('clicked'), 400);
        });

        list.appendChild(p);
      });
    }

    function handleCellClick(r, c, td) {
      /* í¬ë¡œìŠ¤ì›Œë“œ ì •ë‹µ ì²˜ë¦¬ ë¬´ì‹œ */
      if (td.classList.contains('clicked')) return;
      /* í¬ë¡œìŠ¤ì›Œë“œ ì˜¤ë‹µ ì²˜ë¦¬ ë¬´ì‹œ */
      if (td.classList.contains('wrong')) return;

      const relatedWords = cellMap[r][c];

      /* í¬ë¡œìŠ¤ì›Œë“œ ì˜¤ë‹µ ì• ë‹ˆë©”ì´ì…˜ */
      if (!relatedWords) {
        td.classList.add('wrong');
        td.style.pointerEvents = 'none';

        setTimeout(() => {
          td.classList.remove('wrong');
          td.style.pointerEvents = '';
        }, 800);
        return;
      }

      /* í¬ë¡œìŠ¤ì›Œë“œ ì •ë‹µ ì²˜ë¦¬ */
      td.classList.add('clicked');
      td.style.pointerEvents = 'none';

      let completedWords = [];

      relatedWords.forEach(({ wordIndex, charIndex }) => {
        wordProgress[wordIndex]++;
        foundLettersCount++;

        if (wordProgress[wordIndex] === puzzles[currentLevel].words[wordIndex].word.length) {
            completedWords.push(wordIndex);
        }
    });


      if (completedWords.length > 0) {
        completedWords.forEach(idx => markHintCompleted(idx));
        playApplause();
      }

      checkGameComplete();
    }

    function markHintCompleted(wordIndex) {
      const hintList = document.getElementById("hintList");
      const hint = hintList.querySelector(`p[data-word-index="${wordIndex}"]`);
      if (hint) {
        hint.classList.add('completed');
      }
    }

    /* í¬ë¡œìŠ¤ì›Œë“œ ì¢…ë£ŒìŒ */
    function playApplause() {
      const audio = document.getElementById('applause');
      audio.currentTime = 0;
      audio.play();
    }

    /* í¬ë¡œìŠ¤ì›Œë“œ íƒ€ì´ë¨¸ */
    function startTimer() {
        clearInterval(timer);
        timeLeft = 60;
        updateTimerDisplay();

        timer = setInterval(() => {
        timeLeft--;
            updateTimerDisplay();
            updateScoreDisplay();
                if (timeLeft <= 0) {
                clearInterval(timer);
                endGame();
            }
              }, 1000);
    }

    /* í¬ë¡œìŠ¤ì›Œë“œ ì ìˆ˜ */
    function updateScoreDisplay() {
        score = Math.max(0, Math.floor((timeLeft / 60) * 1000));
        document.getElementById("score").textContent = score;
    }

    
    function updateTimerDisplay() {
      const minutes = String(Math.floor(timeLeft / 60)).padStart(2, '0');
      const seconds = String(timeLeft % 60).padStart(2, '0');
      document.getElementById('timer').textContent = `${minutes}:${seconds}`;
    }

    function checkGameComplete() {
        const totalLetters = puzzles[currentLevel].words.reduce((acc, w) => acc + w.word.length, 0);
        if (foundLettersCount >= totalLetters) {
            clearInterval(timer);
            showConfetti();
            setTimeout(() => {
            endGame();
        }, 1500);
      }
    }


    function showConfetti() {
      const confettiContainer = document.getElementById('confetti');
      confettiContainer.innerHTML = '';

      for (let i = 0; i < 60; i++) {
        const confetti = document.createElement('span');
        confetti.style.left = `${Math.random() * 100}%`;
        confetti.style.backgroundColor = `hsl(${Math.random()*360}, 70%, 60%)`;
        confetti.style.animationDuration = `${0.7 + Math.random()}s`;
        confetti.style.top = '0';
        confettiContainer.appendChild(confetti);
      }
    }

    /* í¬ë¡œìŠ¤ì›Œë“œ ì¢…ë£Œ */
    function endGame() {
      document.getElementById('endPopup').style.display = 'flex';
      document.getElementById('finalTime').textContent = `ë‚¨ì€ ì‹œê°„: ${document.getElementById('timer').textContent}`;
      document.getElementById('finalScore').textContent = `ì ìˆ˜: ${score}`;
    }

    /* í¬ë¡œìŠ¤ì›Œë“œ ì‹œì‘ */
    function startGame(level) {
        currentLevel = level;
        document.getElementById('startOverlay').style.display = 'none';
        const puzzle = puzzles[level];
        createGrid(puzzle.size);
        fillWords(puzzle.words);
        fillRandomLetters();
        renderGrid();
        renderHints(puzzle.words);
        score = 1000;
        document.getElementById('score').textContent = score;
        startTimer();
    }

  </script>
</body>
</html>
