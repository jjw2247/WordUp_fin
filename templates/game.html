<!-- 위 코드는 오량어학사전의 단어 게임 부분의 HTML 코드입니다! -->
<!-- 주석 관련 오류는 제보해주길 바랍니다! -->

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>🧩 오량 크로스워드 게임</title>
  <style>

    /* 단어게임 오버레이 */
    body {
      margin: 0;
      font-family: 'Pretendard', sans-serif;
      background: #f5f8f4;
    }

    /* 크로스워드 오버레이 */
    .game-container {
      max-width: 900px;
      margin: 40px auto;
      padding: 30px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      position: relative;
    }

    h2 {
      color: #2E3A29;
      text-align: center;
    }
    /* 점수 & 타이머 오버레이 */
    .score-timer {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      font-size: 20px;
      color: #4F774E;
      font-weight: bold;
    }
    /* 크로스워드 경계 오버레이 */
    table.crossword {
      border-collapse: collapse;
      margin: 0 auto;
      user-select: none;
    }
    /* 크로스워드 박스 오버레이 */
    table.crossword td {
      width: 40px;
      height: 40px;
      text-align: center;
      vertical-align: middle;
      border: 1px solid #4F774E;
      background-color: #F0F5F0;
      border-radius: 12px;
      font-size: 20px;
      font-weight: bold;
      color: #2E3A29;
      cursor: pointer;
      transition: background 0.3s ease, color 0.3s ease;
      user-select: none;
      position: relative;
      overflow: hidden;
    }

    /* 크로스워드 정답 선택 애니메이션 */
    table.crossword td.clicked {
      background-color: #b4e197 !important;
      color: #2e3a29;
      cursor: default;
      transition: background-color 0.4s ease;
      animation: cellClickAnim 0.3s ease;
    }

    /* 크로스워드 오답 선택 애니메이션 */
    table.crossword td.wrong {
      background-color: #f28b82 !important;
      color: white !important;
      cursor: default;
      animation: wrongClickAnim 0.5s ease forwards;
    }

    @keyframes cellClickAnim {
      0% { transform: scale(1); }
      50% { transform: scale(1.15); }
      100% { transform: scale(1); }
    }

    @keyframes wrongClickAnim {
      0% { transform: scale(1) rotate(0deg); }
      50% { transform: scale(1.2) rotate(-10deg); }
      100% { transform: scale(1) rotate(0deg); }
    }

    /* 크로스워드 힌트 오버레이 */
    .hints {
      margin-top: 30px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      font-weight: bold;
      color: #4F774E;
      user-select: none;
    }

    /* 크로스워드 힌트 배경 오버레이 */
    .hints p {
      background-color: #e0f0d9;
      padding: 8px 15px;
      border-radius: 10px;
      margin-bottom: 10px;
      cursor: pointer;
      transition: transform 0.3s ease, background-color 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    /* 크로스워드 힌트 클릭 애니메이션 */
    .hints p.clicked {
      animation: hintClickAnim 0.4s ease forwards;
    }

    @keyframes hintClickAnim {
      0% { transform: scale(1); background-color: #e0f0d9; }
      50% { transform: scale(1.1); background-color: #c6dfc7; }
      100% { transform: scale(1); background-color: #e0f0d9; }
    }

    /* 크로스워드 정답 처리 & 취소선 */
    .hints p.completed {
      color: #999999;
      text-decoration: line-through;
      background-color: #f0f0f0 !important;
      cursor: default;
    }

    .confetti {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 0;
      pointer-events: none;
    }

    .confetti span {
      position: absolute;
      width: 8px;
      height: 8px;
      background-color: red;
      animation: fall 1s linear forwards;
    }

    @keyframes fall {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(500px) rotate(360deg); opacity: 0; }
    }
    /* 단어게임 전체 오버레이 */
    .overlay {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10;
    }
    /* 크로스워드 시작 팝업 오버레이 */
    .popup {
      background: white;
      padding: 30px;
      border-radius: 16px;
      text-align: center;
      max-width: 400px;
      width: 90%;
    }
    /* 크로스워드 시작 팝업 제목 오버레이 */
    .popup h3 {
      margin-bottom: 20px;
      font-size: 22px;
      color: #333;
    }
    /* 크로스워드 시작 팝업 난이도 간격 */
    .popup .level {
      display: flex;
      justify-content: space-between;
      gap: 10px;
    }
    /* 크로스워드 시작 난이도 박스 오버레이 */
    .popup .level div {
      flex: 1;
      padding: 20px 0;
      border-radius: 12px;
      background: #e0eede;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s ease, background 0.3s ease;
    }
    /* 크로스워드 시작 선택 애니메이션 */
    .popup .level div:hover {
      background: #c6dfc7;
      transform: scale(1.05);
    }
    /* 크로스워드 종료 팝업 오버레이 */
    .popup-end {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 20;
    }
    /* 크로스워드 종료 팝업 박스 오버레이 */
    .popup-end .box {
      background: white;
      padding: 30px;
      border-radius: 16px;
      text-align: center;
      max-width: 400px;
      width: 90%;
    }
    .popup-end h3 {
      margin-bottom: 15px;
    }

    .popup-end p {
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
    <!-- 크로스워드 시작 팝업 -->
  <div class="overlay" id="startOverlay">
    <div class="popup">
      <h3>난이도를 골라주세요</h3>
      <div class="level">
        <div onclick="startGame('easy')">🟢 Easy</div>
        <div onclick="startGame('medium')">🟠 Medium</div>
        <div onclick="startGame('hard')">🔴 Hard</div>
      </div>
    </div>
  </div>
    <!-- 크로스워드 게임 오버레이 -->
  <div class="game-container">
    <h2>🧩 오량 크로스워드 게임</h2>
    <div class="score-timer">
      <div>점수 : <span id="score">0</span></div>
      <div>시간 : <span id="timer">05:00</span></div>
      <button onclick="location.reload()">다시하기</button>
    </div>
    <table class="crossword" id="crossword"></table>
    <div class="hints" id="hintList"></div>
    <div class="confetti" id="confetti"></div>
  </div>
    <!-- 크로스워드 종료 팝업 -->
  <div class="popup-end" id="endPopup">
    <div class="box">
      <h3>🎉 게임 완료!</h3>
      <p id="finalTime"></p>
      <p id="finalScore"></p>
      <button onclick="location.reload()">다시하기</button>
    </div>
  </div>
    <!-- 크로스워드 종료음 -->
  <audio id="applause" src="/static/sounds/applause.mp3"></audio>

    <!-- 단어 데이터 -->
  <script>
    const puzzles = {
      easy: {
        size: 3,
        words: [
          { word: '열정', meaning: '강한 몰입 감정'},
          { word: '통찰', meaning: '본질을 꿰뚫는 능력'}
        ]
      },
      medium: {
        size: 5,
        words: [
          { word: '논리', meaning: '체계적인 사고 방식'},
          { word: '해석', meaning: '뜻을 밝힘'}
        ]
      },
      hard: {
        size: 8,
        words: [
          { word: '문맥', meaning: '글의 흐름'},
          { word: '비유', meaning: '직유/은유 같은 표현'},
          { word: '의미', meaning: '단어나 문장의 뜻'},
          { word: '미학', meaning: '아름다움에 대한 철학'}
        ]
      }
    };

    /* 크로스워드 시작 & 초기화 */
    let grid = [];
    let size = 0;
    let timer;
    let timeLeft = 60;
    let score = 0;
    let foundLettersCount = 0;


    /* 크로스워드 진행 상황 */
    let wordProgress = {};

    /* 크로스워드 단어 저장 */
    let cellMap = [];

    let currentLevel = '';

    function createGrid(n) {
      size = n;
      grid = Array.from({ length: n }, () => Array(n).fill(null));
      cellMap = Array.from({ length: n }, () => Array(n).fill(null));
    }

    function fillWords(words) {
  words.forEach((wordObj, wordIndex) => {
    const word = wordObj.word;
    let placed = false;
    let attempts = 0;

    while (!placed && attempts < 100) {
      attempts++;

      const dir = Math.random() < 0.5 ? 'across' : 'down';
      const maxRow = dir === 'across' ? size : size - word.length;
      const maxCol = dir === 'across' ? size - word.length : size;

      const row = Math.floor(Math.random() * maxRow);
      const col = Math.floor(Math.random() * maxCol);

      /* 크로스워드 단어 중복 여부 확인 */
      let canPlace = true;
      for (let i = 0; i < word.length; i++) {
        const r = dir === 'across' ? row : row + i;
        const c = dir === 'across' ? col + i : col;

        const cellChar = grid[r][c];
        if (cellChar !== null && cellChar !== word[i]) {
          canPlace = false;
          break;
        }
      }

      if (canPlace) {
        wordProgress[wordIndex] = 0;
        for (let i = 0; i < word.length; i++) {
          const r = dir === 'across' ? row : row + i;
          const c = dir === 'across' ? col + i : col;

          grid[r][c] = word[i];
          if (!cellMap[r][c]) cellMap[r][c] = [];
          cellMap[r][c].push({ wordIndex, charIndex: i });
        }

        /* 크로스워드 단어 위차 & 방향 저장 */
        wordObj.row = row;
        wordObj.col = col;
        wordObj.dir = dir;

        placed = true;
      }
    }

    if (!placed) {
      console.warn(`단어를 배치하지 못했습니다: ${word}`);
    }
  });
}

      /* 크로스워드 임시 단어 설정 */
    function fillRandomLetters() {
      const chars = "가나다라마바사아자차카타파하";
      for (let r = 0; r < size; r++) {
        for (let c = 0; c < size; c++) {
          if (!grid[r][c]) {
            grid[r][c] = chars[Math.floor(Math.random() * chars.length)];
            cellMap[r][c] = null;
          }
        }
      }
    }

    function renderGrid() {
      const table = document.getElementById("crossword");
      table.innerHTML = "";
      for (let r = 0; r < size; r++) {
        const tr = document.createElement("tr");
        for (let c = 0; c < size; c++) {
          const td = document.createElement("td");
          td.textContent = grid[r][c];
          td.id = `cell-${r}-${c}`;
          td.classList.remove('clicked', 'wrong');
          td.dataset.checked = '';

          td.addEventListener('click', () => handleCellClick(r, c, td));
          tr.appendChild(td);
        }
        table.appendChild(tr);
      }
    }
    
    /* 크로스워드 힌트 */
    function renderHints(words) {
      const list = document.getElementById("hintList");
      list.innerHTML = "";
      words.forEach(({ meaning }, idx) => {
        const p = document.createElement("p");
        p.textContent = `💡 ${meaning}`;
        p.dataset.wordIndex = idx;

        /* 크로스워드 단어 클릭 애니메이션 */
        p.addEventListener('click', () => {
        
          p.classList.add('clicked');
          setTimeout(() => p.classList.remove('clicked'), 400);
        });

        list.appendChild(p);
      });
    }

    function handleCellClick(r, c, td) {
      /* 크로스워드 정답 처리 무시 */
      if (td.classList.contains('clicked')) return;
      /* 크로스워드 오답 처리 무시 */
      if (td.classList.contains('wrong')) return;

      const relatedWords = cellMap[r][c];

      /* 크로스워드 오답 애니메이션 */
      if (!relatedWords) {
        td.classList.add('wrong');
        td.style.pointerEvents = 'none';

        setTimeout(() => {
          td.classList.remove('wrong');
          td.style.pointerEvents = '';
        }, 800);
        return;
      }

      /* 크로스워드 정답 처리 */
      td.classList.add('clicked');
      td.style.pointerEvents = 'none';

      let completedWords = [];

      relatedWords.forEach(({ wordIndex, charIndex }) => {
        wordProgress[wordIndex]++;
        foundLettersCount++;

        if (wordProgress[wordIndex] === puzzles[currentLevel].words[wordIndex].word.length) {
            completedWords.push(wordIndex);
        }
    });


      if (completedWords.length > 0) {
        completedWords.forEach(idx => markHintCompleted(idx));
        playApplause();
      }

      checkGameComplete();
    }

    function markHintCompleted(wordIndex) {
      const hintList = document.getElementById("hintList");
      const hint = hintList.querySelector(`p[data-word-index="${wordIndex}"]`);
      if (hint) {
        hint.classList.add('completed');
      }
    }

    /* 크로스워드 종료음 */
    function playApplause() {
      const audio = document.getElementById('applause');
      audio.currentTime = 0;
      audio.play();
    }

    /* 크로스워드 타이머 */
    function startTimer() {
        clearInterval(timer);
        timeLeft = 60;
        updateTimerDisplay();

        timer = setInterval(() => {
        timeLeft--;
            updateTimerDisplay();
            updateScoreDisplay();
                if (timeLeft <= 0) {
                clearInterval(timer);
                endGame();
            }
              }, 1000);
    }

    /* 크로스워드 점수 */
    function updateScoreDisplay() {
        score = Math.max(0, Math.floor((timeLeft / 60) * 1000));
        document.getElementById("score").textContent = score;
    }

    
    function updateTimerDisplay() {
      const minutes = String(Math.floor(timeLeft / 60)).padStart(2, '0');
      const seconds = String(timeLeft % 60).padStart(2, '0');
      document.getElementById('timer').textContent = `${minutes}:${seconds}`;
    }

    function checkGameComplete() {
        const totalLetters = puzzles[currentLevel].words.reduce((acc, w) => acc + w.word.length, 0);
        if (foundLettersCount >= totalLetters) {
            clearInterval(timer);
            showConfetti();
            setTimeout(() => {
            endGame();
        }, 1500);
      }
    }


    function showConfetti() {
      const confettiContainer = document.getElementById('confetti');
      confettiContainer.innerHTML = '';

      for (let i = 0; i < 60; i++) {
        const confetti = document.createElement('span');
        confetti.style.left = `${Math.random() * 100}%`;
        confetti.style.backgroundColor = `hsl(${Math.random()*360}, 70%, 60%)`;
        confetti.style.animationDuration = `${0.7 + Math.random()}s`;
        confetti.style.top = '0';
        confettiContainer.appendChild(confetti);
      }
    }

    /* 크로스워드 종료 */
    function endGame() {
      document.getElementById('endPopup').style.display = 'flex';
      document.getElementById('finalTime').textContent = `남은 시간: ${document.getElementById('timer').textContent}`;
      document.getElementById('finalScore').textContent = `점수: ${score}`;
    }

    /* 크로스워드 시작 */
    function startGame(level) {
        currentLevel = level;
        document.getElementById('startOverlay').style.display = 'none';
        const puzzle = puzzles[level];
        createGrid(puzzle.size);
        fillWords(puzzle.words);
        fillRandomLetters();
        renderGrid();
        renderHints(puzzle.words);
        score = 1000;
        document.getElementById('score').textContent = score;
        startTimer();
    }

  </script>
</body>
</html>
